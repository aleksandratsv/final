---
title: "Rihanna's evolution"
output: 
  flexdashboard::flex_dashboard:
    theme: journal
    orientation: columns
    vertical_layout: fill
    
    
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(spotifyr)
library(ggplot2)
library(cowplot)
library(compmus)
library(plotly)
```


Inspiration {.storyboard}
=========================================

-----------------------------------------------------------------------


### Why Rihanna 

Rihanna is an iconic figure in the music industry, known for her unique blend of pop, R&B, and reggae-inspired sounds. Her powerful vocals and catchy lyrics have earned her numerous accolades and a massive fan base worldwide, including a big fan among the Computational Musicology students! One of the main reasons why Rihanna’s music is so interesting to study is because of her versatility as an artist. Throughout her career, she has explored different genres and experimented with different sounds, making her a fascinating case study for music students. From the dancehall-inspired beats of “Pon de Replay” to the haunting melodies of “Stay,” Rihanna has consistently pushed the boundaries of what is expected of a pop star. Another reason why I think studying Rihanna’s music is so compelling is because of the themes she explores in her songs. Rihanna’s lyrics often touch on topics such as love, heartbreak, and empowerment, making her music relatable to a wide range of audiences. Her songs have also addressed social and political issues, such as domestic violence and police brutality, highlighting her commitment to using her platform to raise awareness about important issues. Rihanna’s features are also worth studying, as she has collaborated with numerous artists over the years, from Jay-Z to Calvin Harris. Her ability to adapt her sound to different genres and collaborate with diverse artists is a testament to her versatility as a musician and her willingness to experiment with new sounds. In conclusion, I believe that studying Rihanna’s music and features is a very straightforward choice for me as I would be able to appreciate her work on a deeper level. Her unique sound, powerful vocals, and thought-provoking lyrics make her a fascinating case study, and her ability to adapt to different genres and collaborate with diverse artists makes her a compelling subject for any music enthusiast such as myself.

### Popularity of Albums


```{r}
library(tidyverse)
library(spotifyr)
album_ids <- c('4UlGauD7ROb3YbVOFMgW5u', '4FyGpObwABjn0o8Tdp7AZz', '5pvFhFt1nzE8sCbm1wjNRv','3JSWZWeTHF4HDGt5Eozdy7','4XBfFj0WYyh5mBtU61EdyY', '1Kw1bVd07oRqcjrcjQKC8T','7vN82vd1Vq44fjlhjfvHJp')
albums <- get_albums(album_ids)
album_names <- albums$name
album_popularity <- albums$popularity
album_data <- data.frame(album_names, album_popularity)
library(ggplot2)
ggplot(album_data, aes(x = album_names, y = album_popularity)) + 
  geom_bar(stat = "identity", fill = "skyblue") + 
  xlab("Album") + ylab("Popularity") + 
  ggtitle("Popularity of all of Rihanna's albums from 2005 to 2016") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

---------------------------------------------------------

Rihanna's debut album, "Music of the Sun," was released in 2005 and received mixed reviews from critics. However, the album still managed to debut at number ten on the US Billboard 200 chart and eventually sold over two million copies worldwide. Her second album, "A Girl like Me," released in 2006, was more successful than her debut, debuting at number five on the Billboard 200 chart and selling over three million copies worldwide.

However, it was her third album, "Good Girl Gone Bad," released in 2007, that truly catapulted her to superstardom. The album featured hits such as "Umbrella" and "Don't Stop the Music," which were both massive commercial successes, and helped the album sell over nine million copies worldwide.

Rihanna's subsequent albums, "Rated R," "Loud," "Talk That Talk," "Unapologetic," and "Anti," have all been incredibly successful, with each album debuting at number one on the US Billboard 200 chart. "Loud," released in 2010, has sold over eight million copies worldwide, while "Unapologetic" and "Anti" both debuted at number one on the US Billboard 200 chart and have been certified Platinum multiple times.


### Musical Features 

```{r}
library(tidyverse)
library(tidymodels)
library(plotly)
library(heatmaply)
library(protoclust)
library(cowplot)
library(spotifyr)
library(compmus)
library(viridis)


musicofthesun <- get_playlist_audio_features("", "2UWKdEhzUuiRsj1JDabqyY")
anti <- get_playlist_audio_features("", "6ocAx4qSYBM8wol5L92Y2H")
firstlast <-
  musicofthesun |>
  mutate(album = "Music of the sun") |>
  bind_rows(anti |> mutate(album = "Anti")) |>
  mutate(
    album = fct_relevel(album, "Music of the sun", "Anti")
  )


alb <-
  firstlast |>
  ggplot(                          # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = track.popularity,
      colour = danceability,
      label = track.name           # Labels will be interactively visible.
    )
  ) +
  geom_point() +                   # Scatter plot.
  geom_rug(size = 0.1) +           # Add 'fringes' to show data distribution.
  facet_wrap(~album) +           # Separate charts per country.
  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_color_gradient(
    low = "blue", 
    high = "orange", 
    guide = "none"
  ) +
  scale_size_continuous(           # Fine-tune the sizes of each point.
    guide = "none"                 # Remove the legend for size.
  ) +
  theme_light() +                  # Use a simpler theme.
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Energy"
  )

ggplotly(alb)

```

----------------------------------------------------------------------

When analysing the musical features I decided that the best representation choice would be to compare the first and the last album of Rihanna.
For "Music of the Sun," Rihanna's debut album (2005) , the tracks were  heavily influenced by reggae and dancehall, which give them a laid-back, tropical feel. The energy level is generally upbeat and positive, with many of the songs featuring prominent percussion and guitar parts, as well as the general musical features of all tracks are quite similar with the exception of the songs, Now I know, Willing to wait and the Last time. However, the danceability of the tracks is somewhat limited by their mid-tempo grooves and the focus on melody and vocal performance rather than rhythmic complexity.
On the other hand, "Anti" (2016) sees Rihanna exploring a wider range of musical styles and influences, including R&B, hip-hop, and electronic music. The energy level is generally more subdued and introspective, with many of the tracks featuring slower tempos and more minimalistic production. However, the danceability of the tracks is often enhanced by the use of innovative rhythms and textures, as well as Rihanna's sultry vocal delivery.


Chromatograms of the most streamed{.storyboard}
=====================================  

----------------------------------------------
  
### Pon De Replay 

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)
wood <-
  get_tidy_audio_analysis("4TsmezEQVSZNNPv5RJ65Ov") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

wood |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "Pon de Replay") +
  theme_minimal() +
  scale_fill_viridis_c(option = "C",guide = "none" )

```

----------------------------------------------------------------------

"Pon de Replay" (2005) has a happy and upbeat melody. The notes in the melody are mostly from a major scale. The song’s repeating melody  includes some extra notes which add to the cool sound.For example, the riff begins with the notes G, A, and B, but then includes a quick passing tone on the C# before descending back down to the G.The drums and percussion in the song have a fun and danceable rhythm, which makes it a popular song to dance to.


### Unfaithful
```{r}
library(tidyverse)
library(spotifyr)
library(compmus)
wood <-
  get_tidy_audio_analysis("1oh6hjPd82XlGFQGUh2Jfa") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

wood |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "Unfaithful") +
  theme_minimal() +
  scale_fill_viridis_c(option = "C",guide = "none" )

```

----------------------------------------------------------------------

"Unfaithful" is a ballad that features a melancholy melody based on a minor key. The song is in the key of C# minor and makes use of a descending chord progression that creates a sense of emotional gravity.One notable chromatic feature of the song is the use of chromatic passing tones in the vocal melody. For example, in the chorus, the line "And I know that he knows I'm unfaithful" includes a descending melody that features several chromatic passing tones, such as the C# between the B and D notes.Another chromatic element in the song is the use of a descending chromatic scale in the instrumental break before the second chorus. This section also  features a piano melody that descends chromatically through several notes, creating a sense of tension and anticipation.

### Umbrella

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)
wood <-
  get_tidy_audio_analysis("49FYlytm3dAAraYgpoJZux") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

wood |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "Umbrella") +
  theme_minimal() +
  scale_fill_viridis_c(option = "C",guide = "none" )

```

----------------------------------------------------------------------

"Umbrella"   became  a hit ever since it’s release and the track is a personal favorite of mine. The song  features a catchy melody and a strong beat.The song is based on a minor key, specifically the key of B flat minor, which gives it a dark and moody feel.The melody of the song includes several chromatic passing tones, particularly in the verses. For example, in the line "You have my heart, and we'll never be worlds apart," the melody includes the notes A flat and A natural, which are not part of the B flat minor scale but are used as passing tones to add melodic interest.The song also features a chromatic bassline, which descends by half steps during the chorus. This chromatic movement creates a sense of energy and anticipation leading up to the chorus, and adds to the song's overall catchiness.

### Rude Boy
```{r}
library(tidyverse)
library(spotifyr)
library(compmus)
wood <-
  get_tidy_audio_analysis("60jzFy6Nn4M0iD1d94oteF") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

wood |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "Rude Boy") +
  theme_minimal() +
  scale_fill_viridis_c(option = "C",guide = "none" )

```

----------------------------------------------------------------------

"Rude Boy" is primarily based on a minor key, which creates a dark and moody atmosphere. The song is in the key of B minor, with a chord progression  and includes occasional shifts to the relative major (D major).One notable chromatic feature of the song is again the use of chromatic passing tones in the vocal melody of the chorus.

### S&M

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)
wood <-
  get_tidy_audio_analysis("7ySUcLPVX7KudhnmNcgY2D") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

wood |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "S%M") +
  theme_minimal() +
  scale_fill_viridis_c(option = "C",guide = "none" )

```

----------------------------------------------------------------------

The song is based on a minor key, specifically the key of E minor. The use of a minor key gives the song a darker and more serious feel, which contrasts with the playful and provocative lyrics. The melody of the song uses several chromatic passing tones, particularly in the verses which  are used as passing tones to add melodic interest.The chorus of the song features a descending chromatic bassline. The bassline descends to the C# note, which creates a sense of tension and adds to the song's catchy hook.This gives the melody a bluesy feel and adds a bit of edge to the pop sound.


### We found love

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

where <-
  get_tidy_audio_analysis (c("3t4HeVfURZ5DuqMWz0Cmqg")) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

where |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "We Found Love") +
  theme_minimal() +
  scale_fill_viridis_c(option = "C",guide = "none" )
```

----------------------------------------------------------------------

The song is based on the key of F# minor, which gives it a moody and somewhat melancholic feel. However, the driving beat and upbeat tempo give the song an energetic and positive vibe.The melody of the song features several chromatic passing tones, particularly in the verses. For example, in the line "Yellow diamonds in the light, and we're standing side by side," the melody includes the notes A natural and B natural, which are not part of the F# minor scale but are used as passing tones to add melodic interest.The chorus of the song features a descending chromatic bassline. The bassline descends by half-steps from the F# note down to the D# note, which adds to the song's catchy and danceable rhythm.This  again gives the melody a bluesy feel and adds to the song's emotional impact.

### Diamonds

```{r}
where <-
  get_tidy_audio_analysis (c("5pDUMdIiW0rNLzFryqpC9j")) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

where |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "Diamonds") +
  theme_minimal() +
 scale_fill_viridis_c(option = "C",guide = "none" )

```

----------------------------------------------------------------------

"Diamonds" is another favorite pop ballad by Rihanna that features a simple and emotive melody, with a strong focus on the lyrics. The song is based on the key of Bb major, which gives it a bright and uplifting feel. The major key is often associated with happiness and positivity in music, which contrasts with the song's somewhat melancholic lyrics.The melody of the song uses several chromatic passing tones, particularly in the verses. For example, in the line "So shine bright tonight, you and I," the melody includes the notes F natural and G natural.The chorus of the song features a descending chromatic bassline.

### Work

```{r}

library(tidyverse)
library(spotifyr)
library(compmus)

where <-
  get_tidy_audio_analysis (c("72TFWvU3wUYdUuxejTTIzt")) |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

where |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude",title = "Work") +
  theme_minimal() +
  scale_fill_viridis_c(option = "C",guide = "none" )
```

----------------------------------------------------------------------

"Work" is a dancehall-inspired pop song, featuring Drake, which with no surprise  became a chart-topping hit. The song is based on the key of E minor, which gives it a moody and slightly tense feel. The minor key is often associated with sadness and introspection in music, which contrasts with the upbeat dancehall rhythms of the song.The melody of the song features several chromatic passing tones and melodic embellishments, particularly in the verses.The melody includes the notes D# and F#, which are not part of the E minor scale but are used as passing tones to add melodic interest.The chorus of the song features a repeated melodic phrase that emphasizes the notes E, F#, and G. The song also features a number of chromatic chord progressions, particularly in the instrumental sections,used together, for  creating a sense of tension and release that's typical of dancehall music.

Chromatograms and self-similarity matrices{.storyboard}
=========================================

----------------------------------------------------------------------


### Pon de Replay


```{r}

  
  bzt <-
  get_tidy_audio_analysis("4TsmezEQVSZNNPv5RJ65Ov") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  bzt |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  bzt |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")
```

-----------------------------------------------------------------------

Intro (0:00-0:11): The song begins with a brief intro featuring a repeating melody and Rihanna's vocals. Verse 1 (0:11-0:33): The first verse begins with Rihanna's vocals over a sparse beat, building to a more intense chorus. Chorus 1 (0:33-0:56): The first chorus features Rihanna's catchy hook " Come Mr. DJ song pon de replay," over a driving beat. Verse 2 (0:56-1:17): The second verse features a similar structure to the first verse, building to the second chorus. Chorus 2 (1:17-1:41): The second chorus is a repeat of the first chorus. Bridge (1:41-2:02): The bridge provides a contrast to the chorus, featuring a different melody and lyrics Chorus 3 (2:02-2:26): The third chorus is a repeat of the first two choruses, with a few variations in the instrumentation. Outro (2:26-3:18): The song ends with a fade-out of the chorus, featuring Rihanna's vocals and a repeating synth melody.

### Unfaithful

```{r,fig.width=9, fig.height=6}

  unf <-
  get_tidy_audio_analysis("13xxBnXOuiBxVxJI458B0i") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  unf |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  unf |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")
```

-------------------------------------------------------------------

Intro (0:00-0:19): The song begins with a slow and mournful piano melody, which sets the tone for the emotional lyrics that follow. Verse 1 (0:19-0:41): The first verse begins with Rihanna's vocals over a simple piano accompaniment, building to a more intense chorus. Chorus 1 (0:41-1:02): The first chorus features Rihanna's emotive vocals over a more layered and complex instrumental accompaniment. Verse 2 (1:02-1:24): The second verse features a similar structure to the first verse, building to the second chorus. Chorus 2 (1:24-1:45): The second chorus is a repeat of the first chorus, with slight variations in the instrumentation and vocal delivery. Bridge (1:45-2:06): The bridge provides a contrast to the chorus, featuring a different melody and lyrics, as Rihanna sings "I don't wanna be the reason why / Every time I walk out the door / I see him die a little more inside." Chorus 3 (2:06-2:27): The third chorus is a repeat of the first two choruses, with a few variations in the instrumentation. Outro (2:27-3:51): The song ends with a repetition of the intro's piano melody, with Rihanna's vocals fading out.

### Umbrella

```{r,fig.width=9, fig.height=6}
  
  umb <-
  get_tidy_audio_analysis("49FYlytm3dAAraYgpoJZux") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  umb |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  umb |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")
```

----------------------------------------------------------------------

Intro (0:00-0:10): The song begins with a synth chord progression and a simple drum pattern. Verse 1 (0:10-0:43): The first verse features Rihanna's vocals over a sparse instrumental accompaniment, building to a pre-chorus. Pre-chorus (0:43-1:02): The pre-chorus begins with a slightly more intense instrumental accompaniment. Chorus 1 (1:02-1:32): The first chorus features a catchy and repetitive melody, with Rihanna's vocals over a layered and upbeat instrumental accompaniment. Verse 2 (1:32-2:06): The second verse is similar to the first verse, but with slight variations in the instrumentation and vocal delivery. Pre-chorus (2:06-2:25): The pre-chorus is repeated, leading into the second chorus. Chorus 2 (2:25-2:56): The second chorus is a repeat of the first chorus, but with some variations in the instrumentation and vocal ad-libs. Bridge (2:56-3:18): The bridge provides a contrast to the chorus, with a slower tempo and a different chord progression.Chorus 3 (3:18-3:49): The third chorus is a repeat of the first two choruses, with additional vocal ad-libs and harmonies. Outro (3:49-4:13): The song ends with a repetition of the chorus and an instrumental fade-out.

### Rude boy

```{r,fig.width=9, fig.height=6}
rudeb <-
  get_tidy_audio_analysis("60jzFy6Nn4M0iD1d94oteF") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  rudeb |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  rudeb |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")

```

-----------------------------------------------------------------------


Intro (0:00-0:11): The song starts with a drum loop, a synth riff, and Rihanna's vocals.Verse 1 (0:11-0:43): The first verse features Rihanna's vocals over a sparse instrumental accompaniment, building to a pre-chorus.Pre-chorus (0:43-0:59): Starts with a more intense instrumental accompaniment.Chorus 1 (0:59-1:30): The first chorus features a catchy and repetitive melody, with Rihanna's vocals over a layered and upbeat instrumental accompaniment. Verse 2 (1:33-2:05): The second verse is similar to the first verse, but with some variations in the instrumentation and vocal delivery. Pre-chorus (2:05-2:21): The pre-chorus is repeated, leading into the second chorus. Chorus 2 (2:21-2:51): The second chorus is a repeat of the first chorus, but with some variations in the instrumentation and vocal. Bridge (2:51-3:23): The bridge provides a contrast to the chorus, with a slower tempo and a different chord progression. Chorus 3 (3:23-3:53): The third chorus is a repeat of the first two choruses, with additional vocal ad-libs and harmonies. Outro (3:53-4:16): The song ends with a repetition of the chorus and an instrumental fade-out.



### S&M

```{r,fig.width=9, fig.height=6}
sss <-
  get_tidy_audio_analysis("0C4ejWmOTMv8vuYj85mf8m") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  sss |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  sss |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")
```

------------------------------------------------------------------------

Intro (0:00-0:11): The song starts with a drum loop, a synth riff, and Rihanna's vocals.Verse 1 (0:11-0:43): The first verse features Rihanna's vocals over a sparse instrumental accompaniment, building to a pre-chorus.
Pre-chorus (0:43-0:59): Starts with a more intense instrumental accompaniment.Chorus 1 (0:59-1:30): The first chorus features a catchy and repetitive melody, with Rihanna's vocals over a layered and upbeat instrumental accompaniment.Verse 2 (1:33-2:05): The second verse is similar to the first verse, but with some variations in the instrumentation and vocal delivery. Pre-chorus (2:05-2:21): The pre-chorus is repeated, leading into the second chorus. Chorus 2 (2:21-2:51): The second chorus is a repeat of the first chorus, but with some variations in the instrumentation and vocal ad-libs. Bridge (2:51-3:23): The bridge provides a contrast to the chorus, with a slower tempo and a different chord progression. Chorus 3 (3:23-3:53): The third chorus is a repeat of the first two choruses, with additional vocal ad-libs and harmonies. Outro (3:53-4:16): The song ends with a repetition of the chorus and an instrumental fade-out.

### We found love

```{r,fig.width=9, fig.height=6}
love <-
  get_tidy_audio_analysis("0U10zFw4GlBacOy9VDGfGL") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  love |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  love |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")

```

-----------------------------------------------------------------------

Intro (0:00-0:04): The song starts with a repetitive synth riff and Rihanna's vocals. Verse 1 (0:04-0:35): The first verse features Rihanna's vocals over instrumental accompaniment, building to a pre-chorus. Pre-chorus (0:35-0:49): The pre-chorus is a short section that serves as a transition from the verse to the chorus, with a more intense instrumental accompaniment. Chorus 1 (0:49-1:19): The first chorus features a catchy and repetitive melody, with Rihanna's vocals over a layered and upbeat instrumental accompaniment. Verse 2 (1:19-1:50): The second verse is similar to the first verse, but with some variations in the instrumentation and vocal delivery. Pre-chorus (1:50-2:04): The pre-chorus is repeated, leading into the second chorus. Chorus 2 (2:04-2:34): The second chorus is a repeat of the first chorus, but with some variations in the instrumentation and vocal ad-libs. Bridge (2:34-2:49): The bridge provides a contrast to the chorus, with a slower tempo. The third chorus is a repeat of the first two choruses, with additional vocal ad-libs and harmonies. Outro (3:19-3:50): The song ends with a repetition of the chorus and an instrumental fade-out.

### Diamonds

```{r,fig.width=9, fig.height=6}
dia <-
  get_tidy_audio_analysis("6O20JhBJPePEkBdrB5sqRx") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  dia |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  dia |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")
```

----------------------------------------------------------------

Intro (0:00-0:07): The song starts with a slow and atmospheric instrumental intro, with a repeating piano melody and Rihanna's vocals. Verse 1 (0:07-0:38): The first verse features Rihanna's vocals over a sparse instrumental accompaniment, building to a pre-chorus. Pre-chorus (0:38-0:52): The pre-chorus is a short section that serves as a transition. Chorus 1 (0:52-1:22): The first chorus features a catchy and repetitive melody, with Rihanna's vocals over a layered instrumental accompaniment. Verse 2 (1:22-1:53): The second verse is similar to the first verse, but with some variations in the instrumentation and vocal delivery. Pre-chorus (1:53-2:07): The pre-chorus is repeated, leading into the second chorus. Chorus 2 (2:07-2:38): The second chorus is a repeat of the first chorus, but with some variations in the instrumentation and vocal ad-libs. Bridge (2:38-3:09): The bridge provides a contrast to the chorus, with a slower tempo. Chorus 3 (3:09-3:39): The third chorus is a repeat of the first two choruses, with additional vocals and harmonies. Outro (3:39-4:22): The song ends with a repetition of the chorus and an instrumental fade-out.


### Work

```{r,fig.width=9, fig.height=6}
library(tidyverse)
library(spotifyr)
library(compmus)




library(tidyverse)
library(spotifyr)
library(compmus)




rk <-
  get_tidy_audio_analysis("6ELYUjIai7bjtyUocOLCRE") |>
  compmus_align(bars, segments) |>
  select(bars) |>
  unnest(bars) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "acentre", norm = "manhattan"
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "mean"
      )
  )
bind_rows(
  rk |> 
    compmus_self_similarity(pitches, "aitchison") |> 
    mutate(d = d / max(d), type = "Chroma"),
  rk |> 
    compmus_self_similarity(timbre, "euclidean") |> 
    mutate(d = d / max(d), type = "Timbre")
) |>
  mutate() |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_classic() + 
  labs(x = "", y = "")

```

------------------------------------------------------------------

Intro (0:00-0:13): The song starts with a repeating instrumental riff and Rihanna's vocal ad-libs. Verse 1 (0:13-0:39): The first verse features Rihanna's vocals over an instrumental accompaniment, building to a pre-chorus. Pre-chorus (0:39-0:53): The pre-chorus is a short section that serves as a transition again. Chorus 1 (0:53-1:29): The first chorus features Rihanna's vocals over a dancehall-inspired instrumental accompaniment, with a repetitive and catchy melody. Verse 2 (1:29-1:57): The second verse is similar to the first verse, but with some variations in the instrumentation and vocal delivery. Pre-chorus (1:57-2:12): The pre-chorus is repeated, leading into the second chorus. Chorus 2 (2:12-2:49): The second chorus is a repeat of the first chorus, with some variations in the instrumentation and vocal ad-libs. Bridge (2:49-3:04): The bridge is a short section that features a contrasting instrumental accompaniment.Chorus 3 (3:04-3:42): The third chorus is a repeat of the first two choruses, with additional vocal ad-libs and harmonies. Outro (3:42-3:59): The song ends with a repetition of the chorus and an instrumental fade-out.






Chordograms{.storyboard}
=========================================

-----------------------------------------------------------------------

### Pon de replay
  
  ```{r}
library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


pondereplay <-
  get_tidy_audio_analysis("4TsmezEQVSZNNPv5RJ65Ov") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


pondereplay |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")

```

------------------------------------------------------------------------

"Pon de Replay" by Rihanna is a popular dancehall-influenced pop song. The song is primarily in the key of B-flat minor, with a tempo of approximately 100 beats per minute.The chord progression in the song is relatively simple and features a repeating pattern of three chords throughout most of the song. The chords used in "Pon de Replay" are Bb minor, Eb minor, and F# major.

### Unfaithful

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


unfaith <-
  get_tidy_audio_analysis("1oh6hjPd82XlGFQGUh2Jfa") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


unfaith |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C" , guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
```

-----------------------------------------------------------------------

"Unfaithful" by Rihanna is a pop ballad that features a piano-based accompaniment with a simple yet powerful harmonic structure. The song is primarily in the key of C minor, with a tempo of approximately 90 beats per minute.The chord progression in "Unfaithful" is relatively simple, featuring a repeating pattern of four chords throughout the song. The chords used in "Unfaithful" are C minor, Bb major, Ab major, and G major.

### Umbrella

  ```{r}

library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


umbrella <-
  get_tidy_audio_analysis("49FYlytm3dAAraYgpoJZux") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


umbrella |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")

```

----------------------------------------------------------------------

"Umbrella" by Rihanna is a pop song with R&B and hip-hop influences. The song is primarily in the key of C# minor, with a tempo of approximately 87 beats per minute.The chord progression in "Umbrella" is relatively simple, featuring a repeating pattern of three chords throughout most of the song. The chords used in "Umbrella" are C# minor, B major, and A major.



### Rude Boy

  
  
  ```{r}
library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


rudeboy <-
  get_tidy_audio_analysis("60jzFy6Nn4M0iD1d94oteF") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


rudeboy |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
```

-------------------------------------------------------------------------

"Rude Boy" by Rihanna is a dancehall and reggae-influenced pop song. The song is primarily in the key of B minor, with a tempo of approximately 87 beats per minute.The chord progression in "Rude Boy" is relatively simple, featuring a repeating pattern of four chords throughout most of the song. The chords used in "Rude Boy" are B minor, D major, G major, and A major.  

### S&M

 ```{r}
library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


snm <-
  get_tidy_audio_analysis("0C4ejWmOTMv8vuYj85mf8m") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


snm |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
  
```

--------------------------------------------------------------

"S&M" by Rihanna is an electro-pop and dance-pop song with influences from house and techno music. The song is primarily in the key of E-flat major, with a tempo of approximately 128 beats per minute.The chord progression in "S&M" is relatively simple, featuring a repeating pattern of four chords throughout most of the song. The chords used in "S&M" are E-flat major, B-flat major, C minor, and G minor.



### We found love 

  
  
  ```{r}
library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


wefoundlove <-
  get_tidy_audio_analysis("0U10zFw4GlBacOy9VDGfGL") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


wefoundlove |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")

```

-------------------------------------------------------------------------

 "We Found Love" by Rihanna is an upbeat dance-pop and EDM song with influences from house and techno music. The song is primarily in the key of G major, with a tempo of approximately 128 beats per minute.The chord progression in "We Found Love" is relatively simple, featuring a repeating pattern of four chords throughout most of the song. The chords used in "We Found Love" are G major, D major, Em, and C major.
 

### Diamonds

  
  
  ```{r}
library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


diamonds <-
  get_tidy_audio_analysis("5pDUMdIiW0rNLzFryqpC9j") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


diamonds |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
```

-------------------------------------------------------------------------

"Diamonds" by Rihanna is a mid-tempo pop ballad with a prominent piano riff and a chorus that features electronic beats. The song is primarily in the key of B-flat major, with a tempo of approximately 92 beats per minute.The chord progression in "Diamonds" is relatively simple, featuring a repeating pattern of four chords throughout most of the song. The chords used in "Diamonds" are B-flat major, G minor, E-flat major, and F major.

  
### Work

  
  
  ```{r}
library(tidyverse)
library(spotifyr)
library(compmus)


circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )


work <-
  get_tidy_audio_analysis("5gZsEYaYvyi1sAVyuiXbDm") |>
  compmus_align(sections, segments) |>
  select(sections) |>
  unnest(sections) |>
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      )
  )


work |> 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) |>
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")
```

-----------------------------------------------------------------------

"Work" by Rihanna is a dancehall-inspired pop song with a prominent beat and lyrics. The song is primarily in the key of A minor, with a tempo of approximately 92 beats per minute.The chord progression in "Work" is relatively simple, featuring a repeating pattern of four chords throughout most of the song. The chords used in "Work" are A minor, E minor, D major, and F major.   

  
  

Fourier-based tempograms{.storyboard}
=====================================  

----------------------------------------------


### Pon de Replay

```{r}

pondrpl <- get_tidy_audio_analysis("4TsmezEQVSZNNPv5RJ65Ov")

pondrpl |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

--------------------------------------------------------------

"Pon de Replay" by Rihanna has a specific tempo of around  99/100  beats per minute (BPM). The  tempo falls within the range of what is considered a mid-tempo song, which can be described as having a moderate pace that is neither too fast nor too slow. The steady beat of 99 BPM in "Pon de Replay" gives the song a catchy and danceable feel, which possibly helped make it a hit when it was released in 2005

### Unfaithful 

```{r}
unfaith <- get_tidy_audio_analysis("1oh6hjPd82XlGFQGUh2Jfa")

unfaith |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

--------------------------------------------------------------

"Unfaithful" by Rihanna has a tempo of 90 beats per minute (BPM). This tempo also falls within the range of what is typically considered a mid-tempo song, which can be described as having a moderate pace that is again neither too fast nor too slow. The tempo of 90 BPM in "Unfaithful"  however is  slower than the tempo of Rihanna's earlier hit "Pon de Replay", which has a tempo of 99 BPM. The slower tempo of "Unfaithful" gives the song a more contemplative and melancholy feel, which suits the song's subject matter of a troubled relationship..

### Umbrella

```{r}
umbr <- get_tidy_audio_analysis("49FYlytm3dAAraYgpoJZux")

umbr |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

--------------------------------------------------------------

"Umbrella" by Rihanna has a tempo of 87 beats per minute (BPM). This tempo falls within the range of what is again  typically considered a mid-tempo song. The tempo of 87 BPM in "Umbrella" is slower than the tempo of Rihanna's earlier hit "Pon de Replay" (99 BPM) but slightly faster than the tempo of "Unfaithful" (90 BPM).
The steady beat of 87 BPM in "Umbrella" gives the song a relaxed and catchy feel, which made it a hit when it was released in 2007. Additionally, the use of a simple but memorable drum pattern and bassline throughout the song, combined with Rihanna's vocal performance, contributed  to the song's overall rhythmic groove.


### Rude Boy

```{r}

rud <- get_tidy_audio_analysis("60jzFy6Nn4M0iD1d94oteF")

rud |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

--------------------------------------------------------------

"Rude Boy" by Rihanna has a specific tempo of 87  beats per minute (BPM). This tempo falls again within  the range of what is typically considered a mid-tempo song. The tempo of 87 BPM in "Rude Boy" is the same as the tempo of Rihanna's hit "Umbrella" and is slightly slower than the tempo of her earlier hit "Pon de Replay" (99 BPM).The steady beat of 87 BPM in "Rude Boy" gives the song a danceable and infectious feel, which  made it a hit when it was released in 2010. The song features a syncopated rhythm and a catchy melody, with Rihanna's vocal performance emphasizing the song's upbeat and playful nature. The tempo of "Rude Boy" contributes to its overall energy and groove, making it a popular dance track.

### S&M

```{r}
snm <- get_tidy_audio_analysis("7ySUcLPVX7KudhnmNcgY2D")

snm |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

----------------------------------------------------------------
 
"S&M" by Rihanna has a unique  tempo of 129 beats per minute (BPM), considering the previous tracks. This tempo can be considered as a  fast-paced song, which can be described as having a quick pace that is energetic and upbeat. The tempo of 129 BPM in "S&M" is notably faster than the tempos of Rihanna's earlier hits "Unfaithful" (90 BPM) and "Umbrella" (87 BPM), and also faster than her mid-tempo hit "Rude Boy" (87 BPM). The fast tempo of "S&M" gives the song a frenetic and exciting feel, which helps to emphasize the song's provocative lyrics and playful tone. The song features a strong beat, with a driving bassline and percussion elements that add to its overall energy. The song also features the use of electronic and synthesizer elements which contribute to its overall sound and production. 

### We found love


```{r}

wefound <- get_tidy_audio_analysis("0U10zFw4GlBacOy9VDGfGL")

wefound |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

------------------------------------------------------------

"We Found Love" by Rihanna has a specific tempo of 128 beats per minute (BPM). This tempo also  falls within the range of what is typically considered a fast-paced song. The tempo of 128 BPM in "We Found Love" is similar to the tempo of Rihanna's hit "S&M" (129 BPM). The fast tempo of "We Found Love"  gives the song a pulsing and driving feel, which helps to emphasize the song's theme of an intense and passionate love affair. The song features a strong beat, with electronic and synthesizer elements that create a danceable and hypnotic sound. The tempo, combined with the song's memorable melody and Rihanna's emotive vocal performance, helped make "We Found Love" a hit when it was released in 2011. The song's tempo also is very  popular in dance clubs and on dance music charts, EDM  is typically featured.


### Diamonds 

```{r}
diam <- get_tidy_audio_analysis("5pDUMdIiW0rNLzFryqpC9j")

diam |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()

```

--------------------------------------------------------------------

"Diamonds" by Rihanna has a tempo of 92 beats per minute (BPM). This tempo falls again within the range of mid-tempo song, which can be described. The tempo of 92 BPM in "Diamonds" is similar to the tempo of Rihanna's earlier hit "Unfaithful" (90 BPM).The moderate tempo of "Diamonds" gives the song a dreamy and contemplative feel, which emphasizes the song's theme of finding hope and strength in difficult times. The song features a pulsing beat, with electronic and percussion elements that add to its overall energy. Additionally, the song's memorable melody and Rihanna's emotive vocal performance contribute to its overall impact as a powerful and emotional ballad. 


### Work 

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)



work <- get_tidy_audio_analysis("5gZsEYaYvyi1sAVyuiXbDm")

work |>
  tempogram(window_size = 8, hop_size = 1, cyclic = TRUE) |>
  ggplot(aes(x = time, y = bpm, fill = power)) +
  geom_raster() +
  scale_fill_viridis_c(option = "C", guide = "none") +
  labs(x = "Time (s)", y = "Tempo (BPM)") +
  theme_classic()
```

----------------------------------------------------------------------

"Work" by Rihanna has a specific tempo of 92 beats per minute (BPM). This tempo falls again  within the range of what is typically considered a mid-tempo song. The tempo of 92 BPM in "Work" is the same as the tempo of Rihanna's earlier hit "Diamonds".The steady beat of 92 BPM in "Work" gives the song a danceable feel. The song features a repetitive, syncopated rhythm and a catchy melody, with Rihanna's vocal performance emphasizing the song's upbeat and playful nature. Additionally, the song features elements of Caribbean music, including dancehall and reggae, which contribute to its overall sound and production.


Dendogram {.storyboard}
=====================================  

----------------------------------------------------------------------


### Dendogram 

```{r}
library(tidymodels)
library(ggdendro)

random <- get_playlist_audio_features("spotify", "5DICtJRRRPo9oThxuLFaRV")
moststr <- get_playlist_audio_features("spotify", "50U47r9oXMDHIl1CwCs96o")


rihanna <-
  bind_rows(
    random |> mutate(playlist = "Random Rih") |> slice_head(n = 20),
    moststr |> mutate(playlist = "Most Streamed") |> slice_head(n = 20)
  ) |> 
  add_audio_analysis()


# Note that you are not allowed to have duplicate songs in the dataset! 
rihanna |>
  count(track.name) %>%
  arrange(desc(n))

# Grab only track names where it's listed more than once
tracks_to_remove <- rihanna |>
  count(track.name) |>
  filter(n >= 2) %>%
  select(track.name)

rihanna <- rihanna %>%
  anti_join(tracks_to_remove)

# Similar to code from class, still trying to predict track.name but later we add on playlist name!
rihanna_juice <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo,
    data = rihanna
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(rihanna |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

rihanna_dist <- dist(rihanna_juice, method = "euclidean")

data_for_rihanna_clustering <- rihanna_dist |> 
  hclust(method = "average") |> # average for a balanced tree!
  dendro_data() 

playlist_data_for_join <- rihanna %>%
  select(track.name, playlist_name) %>%
  mutate(label = str_trunc(track.name, 20))

data_for_rihanna_clustering$labels <- data_for_rihanna_clustering$labels %>%
  left_join(playlist_data_for_join)

# Add factor so can use colouring! 
data_for_rihanna_clustering$labels$label <- factor(data_for_rihanna_clustering$labels$label)


data_for_rihanna_clustering |>
  ggdendrogram() +
  geom_text(data = label(data_for_rihanna_clustering), aes(x, y, 
                                                         label=label, 
                                                         hjust=0, 
                                                         colour=playlist_name), size=3) +
  coord_flip() + 
  scale_y_reverse(expand=c(0.2, 0)) +
  theme(axis.line.y=element_blank(),
        axis.ticks.y=element_blank(),
        axis.text.y=element_blank(),
        axis.title.y=element_blank(),
        panel.background=element_rect(fill="white"),
        panel.grid=element_blank()) +
  labs(title = "Playlist Clustering") +
  guides(
    colour = guide_legend(
      title = "Playlist"
    )
  )
```

---------------------------------------------------------------

This dendogram is a generated representation of the linkages between the most streamed songs of Rihanna for all combined with random selection of 8 of her other songs ranging from 2005-2016.It seems that Shut up and Drive is the song with the most obvious linkage to the rest of the sampled songs. 


Conclusion and main takeaways {.storyboard}
=====================================  

----------------------------------------------------------------------

### Conclusion 

I'm grateful that I got the chance to enroll in this course, which taught me how to create this portfolio from scratch. The findings I came up with gave me valuable insights into one of the most important musicians of our day, Rihanna, and her creative output. By analyzing the elements of her songs, I was capable of recognizing that Rihanna's versatility and power to create songs with a strong emotional connection to her audience are what make her so distinctive. Her most popular songs, including Pon de replay, Umbrella, Rude boy, S&M, Diamonds, and Work, reflect her originality and the depth of her work includes songs based on themes concerning  mental health, love, breakups, and other universally relatable topics.

Furthermore, throughout this project, I have gained an in-depth understanding of her music in terms of the musical arrangements and production techniques  that were behind her music 
The use of R Studio on the other hand  has also been an excellent learning experience for me. Through this project, I have gained practical experience in using various R packages such as spotifyr, ggplot2, and dplyr to analyze and visualize music data. R Studio and the weekly homeworks  enabled me to explore the many different facets of Rihanna's music, from its emotional content to its rhythm and harmony. I have also developed a deeper understanding of music theory concepts such as timbre, rhythm, and harmony.

Additionally, I am happy that with this portfolio I have learned how to work with and visualize large datasets, which is a valuable skill to have. The project has definitely  challenged me to use my critical thinking skills to analyze and interpret data, leading to new insights and a better understanding of the musical work of Rihanna.
Overall, this portfolio has been a valuable learning experience that has helped me to grow both academically  and personally. Despite the fact that I have no musical training and have never completed a project of this kind, it has helped me develop a greater appreciation for music as an art form and given me the skills necessary to better evaluate and comprehend music.

